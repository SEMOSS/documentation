"use strict";(self.webpackChunkcfg_docs=self.webpackChunkcfg_docs||[]).push([[576],{22204:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var t=n(74848),s=n(28453);const i={sidebar_label:"Sandbox Deployment",sidebar_position:1},o=void 0,c={id:"Advanced Installation/Deploying a Private Server/Sandbox Deployment",title:"Sandbox Deployment",description:"Infrastructure Requirements",source:"@site/docs/Advanced Installation/Deploying a Private Server/Sandbox Deployment.md",sourceDirName:"Advanced Installation/Deploying a Private Server",slug:"/Advanced Installation/Deploying a Private Server/Sandbox Deployment",permalink:"/documentation/Advanced Installation/Deploying a Private Server/Sandbox Deployment",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Sandbox Deployment",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Deployment",permalink:"/documentation/category/deployment"},next:{title:"High Availability Deployment",permalink:"/documentation/Advanced Installation/Deploying a Private Server/High Availability Deployment"}},l={},a=[{value:"Infrastructure Requirements",id:"infrastructure-requirements",level:2},{value:"Deploy AI server using a Docker container (Non-Prod)",id:"deploy-ai-server-using-a-docker-container-non-prod",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Docker Login",id:"docker-login",level:4},{value:"Docker Deployment Scripts",id:"docker-deployment-scripts",level:3},{value:"Optional",id:"optional",level:4}];function d(e){const r={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"infrastructure-requirements",children:"Infrastructure Requirements"}),"\n",(0,t.jsx)(r.p,{children:"The minimum requirements include 32 GB of RAM, 8 CPU cores, and a 200 GB disk size. Additionally, GPU support is needed with 2 nodes, each having a 200 GB disk.\r\nWe aim to have both CPU and GPUs available for each of the nodes."}),"\n",(0,t.jsx)(r.h2,{id:"deploy-ai-server-using-a-docker-container-non-prod",children:"Deploy AI server using a Docker container (Non-Prod)"}),"\n",(0,t.jsx)(r.p,{children:"This talks about how you can test the exiting docker image in the sandbox. We would need couple of scripts in order to run the docker image in a VM and perform testing."}),"\n",(0,t.jsx)(r.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(r.h4,{id:"docker-login",children:"Docker Login"}),"\n",(0,t.jsxs)(r.p,{children:["Before you begin, ensure that you have Docker installed on your machine. If not, you can download and install Docker from the official website: ",(0,t.jsx)(r.a,{href:"https://docs.docker.com/get-started/",children:"Docker - Get Started"}),"."]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Obtain Docker Registry Credentials"}),"\n",(0,t.jsxs)(r.li,{children:["Login into ",(0,t.jsx)(r.a,{href:"https://docker.cfg.deloitte.com/",children:"https://docker.cfg.deloitte.com/"})]}),"\n",(0,t.jsx)(r.li,{children:"Copy the CLI secret from User Profile"}),"\n",(0,t.jsxs)(r.li,{children:["Log in to the Docker Registry and obtain CLI secret. Use the following command to log in to your Docker registry ",(0,t.jsx)(r.code,{children:"docker login docker.cfg.deloitte.com"})]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"docker-deployment-scripts",children:"Docker Deployment Scripts"}),"\n",(0,t.jsxs)(r.p,{children:["You can find the ",(0,t.jsx)(r.a,{href:"https://repo.semoss.org/gen-ai/cfgai-deployment/-/tree/master/dev-grade-deployment",children:"deployment scripts"})," here."]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Create a configuration file (e.g., config.env) that defines the common variables. It might look like this:"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"config.env"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'currDir="/path/to/your/directory"\r\ndockerImage=docker.cfg.deloitte.com/genai/genai-server:4.3.0-SNAPSHOT-dev-latest\n'})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:'Replace "/path/to/your/directory" with the actual path you want to use'}),"\n"]}),"\n",(0,t.jsxs)(r.ol,{start:"2",children:["\n",(0,t.jsx)(r.li,{children:"Run the init.sh script: This script will pull the Docker image, create a container, copy its contents to the specified local directory, and  perform cleanup."}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"init.sh"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:" #!/bin/bash\r\n source /path/to/config.env\r\n mkdir -p $currDir\r\n docker pull $dockerImage\r\n docker run -itd --name semosstmp $dockerImage bash\r\n docker cp semosstmp:/opt/semosshome $currDir\r\n docker kill semosstmp\r\n docker rm semosstmp\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"/opt/semosshome:"})," This directory serves as the central hub for storing various components, including databases, model connections,  and projects. It acts as the primary location for organizing and managing your system's key elements."]}),"\n",(0,t.jsx)(r.li,{children:'Replace "/path/to/config.env" with the actual path to your config.env file.'}),"\n"]}),"\n",(0,t.jsxs)(r.ol,{start:"3",children:["\n",(0,t.jsx)(r.li,{children:"Automates the setup of an AI server by sourcing configuration, running a Docker container with volume mapping and port forwarding:"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"startSEMOSS.sh"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"#!/bin/bash\r\n source /path/to/config.env\r\n docker run -itd --name ai-server \\\r\n -v $currDir/semosshome:/opt/semosshome \\\r\n -p 8080:8080 $dockerImage\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:'Replace "/path/to/config.env" with the actual path to your config.env file.'}),"\n",(0,t.jsxs)(r.li,{children:["If you intend to run the server in a Docker container with GPU support, use the --gpus flag to specify GPU devices. You can either provide the GPU IDs or use 'all' to utilize all available GPUs. Example:",(0,t.jsx)(r.code,{children:"docker run --gpus all -d your_image_name"})]}),"\n"]}),"\n",(0,t.jsxs)(r.ol,{start:"4",children:["\n",(0,t.jsx)(r.li,{children:'Script to stop and remove a Docker container named "ai-server".'}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"stopSEMOSS.sh"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"#!/bin/bash\r\n docker kill ai-server\r\n docker rm ai-server\n"})}),"\n",(0,t.jsxs)(r.ol,{start:"5",children:["\n",(0,t.jsx)(r.li,{children:"Execute the below script to perform a restart."}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"restartSEMOSS.sh"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:" #!/bin/bash\r\n /path/to/your/directory/stopSEMOSS.sh\r\n /path/to/your/directory/startSEMOSS.sh\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:'Replace "/path/to/your/directory" with the actual path.'}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"optional",children:"Optional"}),"\n",(0,t.jsx)(r.p,{children:"Systemd is entirely optional element to start AI server."}),"\n",(0,t.jsxs)(r.ol,{start:"6",children:["\n",(0,t.jsx)(r.li,{children:"Systemd service configuration for an AI server."}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"ai.service"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:" [Unit]\r\n Description=Health check script\r\n After=network.target\r\n\r\n [Service]\r\n User=root\r\n WorkingDirectory=/path/to/your/directory\r\n ExecStart=/usr/bin/python3 /path/to/your/directory/startHealthCheck.py\r\n\r\n [Install]\r\n WantedBy=multi-user.target\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"Copy the startHealthCheck.py from cfg-ai-server-scripts folder."}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:'Replace WorkingDirectory "/path/to/your/directory" with the actual path.'}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"Provide absolute path to the startHealthCheck.py script."}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:'As a psuedo user, copy the contents of this file to the following location: "/lib/systemd/system/service".'}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"To manage the AI server using systemd, use the following systemctl commands:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:" # Reload the AI server service after making changes to the systemd service file\r\n sudo systemctl daemon-reload \r\n\r\n # Enable the AI server service to start on boot\r\n sudo systemctl enable ai.service \r\n\r\n # Start the AI server service\r\n sudo systemctl start ai.service \r\n\r\n # Stop the AI server service\r\n sudo systemctl stop ai.service \r\n\r\n # Check the status of the AI server service\r\n sudo systemctl status ai.service \n"})}),"\n",(0,t.jsxs)(r.ol,{start:"7",children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Locate the script where the ",(0,t.jsx)(r.em,{children:"run_restart_script()"})," function is defined."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsx)(r.p,{children:"Look for the run_restart_script function in your script. It should resemble the following:"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'def run_restart_script():\r\n    # replace this with the path to your restart script\r\n    subprocess.call(["/path/to/your/directory/restartSEMOSS.sh"])\n'})}),"\n",(0,t.jsxs)(r.ol,{start:"9",children:["\n",(0,t.jsx)(r.li,{children:"Update the path in the subprocess.call line to point to the correct location of your restartSEMOSS script."}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>c});var t=n(96540);const s={},i=t.createContext(s);function o(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);